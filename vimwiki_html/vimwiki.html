<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<link rel="Stylesheet" type="text/css" href="style.css">
<title>vimwiki</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>

<h1 id="toc_1">vimwiki 语法</h1>

<ul>
<li>
<a href="file:///home/yang/vimwiki/vimwiki.txt">Full_English_Version</a>

<li>
<a href="https://code.google.com/p/vim-script-cn/source/browse/trunk/doc/vimwiki.cnx">完整中文版本</a>

</ul>

<ul>
<li>
文本字型

<ul>
<li>
<code>*粗体*</code> <strong>粗体</strong>

<li>
<code>_斜体_</code> <em>斜体</em>

<li>
<code>~~删除线~~</code> <del>删除线</del>

<li>
<code>代码(无语法)</code> <code>代码</code>

<li>
<code>上标^上标^</code> 上标<sup><small>上标</small></sup>

<li>
<code>下标,,下标,,</code> 下标<sub><small>下标</small></sub>

</ul>
</ul>

<ul>
<li>
链接

<ul>
<li>
<code>[[链接]]</code> 链接

<li>
<code>[[链接|链接描述]]</code> 或 <code>[[链接][链接描述]]</code>

<li>
直接链接
    <a href="http://code.google.com/p/vimwiki">http://code.google.com/p/vimwiki</a>
    <a href="mailto:habamax@gmail.com">mailto:habamax@gmail.com</a>
    <a href="ftp://vim.org">ftp://vim.org</a>

</ul>
</ul>

<ul>
<li>
标题

<ul>
<li>
<code>= 一级标题 =</code> 一级标题

<li>
<code>= 二级标题 =</code> 二级标题

<li>
<code>=</code> 前加空格使标题居中

</ul>
</ul>

<ul>
<li>
段落

<ul>
<li>
<code>- 段落一</code>

<li>
<code>* 段落二</code>

<ul>
<li>
<code>- 子段落一</code>

<li>
<code>* 子段落二</code>

</ul>
<li>
<code># 第一</code>

<li>
<code># 第二</code>
<pre>
- 段落
* 段落
  *  子段落
    # 子子第一
    # 子子第二
* 段落
</pre>

<li>
<code>- 和*</code> 可以混用

<li>
使用空行分段

</ul>
</ul>

<ul>
<li>
表格

<ul>
<li>
基本表格
<pre>
  | head1  | head2  |
  | value1 | value2 |
  | value3 | value4 |
</pre>

</ul>
</ul>
<table>
<tr>
<td>
head1
</td>
<td>
head2
</td>
</tr>
<tr>
<td>
value1
</td>
<td>
value2
</td>
</tr>
<tr>
<td>
value3
</td>
<td>
value4
</td>
</tr>
</table>

<ul>
<li>
表头高亮
<pre>
  | head1  | head2  |
  |--------|--------|
  | value1 | value2 |
  | value3 | value4 |
</pre>

</ul>
<table>
<tr>
<th>
head1
</th>
<th>
head2
</th>
</tr>
<tr>
<td>
value1
</td>
<td>
value2
</td>
</tr>
<tr>
<td>
value3
</td>
<td>
value4
</td>
</tr>
</table>

<ul>
<li>
手动排列表格
<pre>
  | a  | b  | c | d |
  | \/ | e  | &gt; | f |
  | \/ | \/ | &gt; | g |
  | h  | &gt;  | &gt; | &gt; |
</pre>

</ul>
<table>
<tr>
<td rowspan="3">
a
</td>
<td>
b
</td>
<td>
c
</td>
<td>
d
</td>
</tr>
<tr>
<td rowspan="2" colspan="2">
e
</td>
<td>
f
</td>
</tr>
<tr>
<td>
g
</td>
</tr>
<tr>
<td colspan="4">
h
</td>
</tr>
</table>
<p>
5.7. Preformatted text                           <strong>vimwiki-syntax-preformatted</strong>
</p>

<p>
Use {{{ and }}} to define a block of preformatted text:
</p>
<pre  &gt;>
  Tyger! Tyger! burning bright
   In the forests of the night,
    What immortal hand or eye
     Could frame thy fearful symmetry?
  In what distant deeps or skies
   Burnt the fire of thine eyes?
    On what wings dare he aspire?
     What the hand dare sieze the fire?
</pre>


<p>
You can add optional information to {{{ tag: &gt;
</p>
<pre>
 &lt;pre class="brush: python"&gt;
 def hello(world):
     for x in range(10):
         print("Hello {0} number {1}".format(world, x))
</pre>
<p>
<script type="text/javascript" src="<a href="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>">http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></a>
<script> type="text/javascript" src="<a href="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"</script>">http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"</script></a>
</p>
<ul>
<li>
数学公式

<ul>
<li>
内联公式$$

</ul>
</ul>
<p>
\( \sum_i a_i^2 = 1 \)
</p>
\[
\sum_i a_i^2
=
1
\]
<p>
请添加 <code>&lt;script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"&gt;&lt;/script&gt; </code>
</p>

<ul>
<li>
注释

<ul>
<li>
<code>%% 注释</code>

</ul>
</ul>

<ul>
<li>
标题

<ul>
<li>
<code>%title 标题</code>

</ul>
</ul>

<ul>
<li>
不转换 html

<ul>
<li>
<code>%nohtml</code>

</ul>
</ul>

<ul>
<li>
水平线

<ul>
<li>
在行首四个或更多减号

<li>
<code>----</code>

</ul>
</ul>

<hr />
<p>
以下内容转载自<a href="http://wiki.ktmud.com/tips/vim/vimwiki-guide.html">丘迟的维基世界</a>
<hr />
</p>

<ul>
<li>
在wiki里使用更多的HTML标签

</ul>

<p>
vimwiki 有一个 g:vimwiki_valid_html_tags 值，可以指定允许写在 wiki 中的HTML标签。 g:vimwiki_valid_html_tags 的默认值是 'b,i,s,u,sub,sup,kbd,br,hr' ，也就是说，当你在 wiki 中输入：
</p>
<blockquote>
<code>&lt;b&gt;Hello&lt;/b&gt; &lt;strong&gt;Hello&lt;/stong&gt;</code>
</blockquote>

<p>
输出的HTML会显示为：
</p>
<blockquote>
<b>Hello</b> &lt;strong&gt;Hello&lt;/stong&gt;
</blockquote>

<p>
标签 b 被当作可用的HTML标签，而 strong 则输出为文本。
</p>

<p>
但有时候我们需要建立更强大的维基页面，不只用到这几个标签。比如本站首页的“有什么特别的”部分，就是一个有特定 class 和 id 的 div。于是在 vimrc 中定义：
</p>
<blockquote>
<code>let g:vimwiki_valid_html_tags='b,i,s,u,sub,sup,kbd,br,hr,div,del,code'</code>
</blockquote>

<p>
在这里我添加了 div, del, code 三个标签。
</p>

<p>
但是，非常不幸，当我们需要在维基里贴HTML代码，即使我们把代码放到了 {{{ }}} 包裹的 pre 里，这几个标签还是会被输出为实际的HTML标签，而不是文本。
</p>

<p>
解决办法还是修改 vimwiki_html.vim 这个文件。
</p>

<p>
找到 " WIKI2HTML "{{{ 所在行，也就是开始转换HTML的地方。
</p>

<p>
在前面添加一个函数：
</p>

<p>
function s:parse_tag_keeper(line)
  let line = substitute(a:line,'\\&amp;lt;',
</p>
<blockquote>
\'\&amp;lt;', 'g')
</blockquote>
<p>
  let line = substitute(line,'\\&amp;gt;',
</p>
<blockquote>
\'\&amp;gt;', 'g')
</blockquote>
<p>
  return line
endfunction
</p>

<p>
然后在之后的 s:parse_line(line, state) 函数内，插入这个函数的调用：
</p>
<blockquote>
...
</blockquote>
<blockquote>
let line = s:safe_html(a:line)
let line = s:parse_tag_keeper(line)
</blockquote>

<p>
这样如果我们用 &lt;tag&gt; 的形式输入 valid_html_tags 包括的标签，输出的HTML就会把它们当成文本处理了。
</p>

<p>
在写本文时，我需要输出 {{{ }}} ，而这对标记被作为了 wiki 里 pre 区块的 pattern 。于是就还要再写一个函数：
</p>

<p>
function s:parse_pre_keeper(line)
  let line = substitute(a:line,'\\{\\{\\{',
</p>
<blockquote>
\'{{{', 'g')
</blockquote>
<p>
  let line = substitute(line,'\\}\\}\\}',
</p>
<blockquote>
\'}}}', 'g')
</blockquote>
<p>
  return line
endfunction
</p>

<p>
就把它定义在 s:parse_tag_keeper 之后吧。但调用的时候怎么办呢？肯定要放在 vimwiki_html.vim 处理了 pre 区块之后。思来想去，只能放在刚好要输出HTML文件的时候。但是 vim 的 writefile 函数，接受的参数是一个 list （相当于数组），而不是字串。既然如此，我们就把输出结果给合并了再替换，然后再包装成 list 。
</p>

<p>
找到这句：
</p>
<blockquote>
call writefile(ldest, path.wwFileNameOnly.'.html')
</blockquote>

<p>
稍微修改一下：
</p>

<p>
let output = join(ldest, "\n\r")
let output = s:parse_pre_keeper(output)
let outputlist = split(output, "\n\r")
call writefile(outputlist, path.wwFileNameOnly.'.html')
</p>

<p>
之所以还要再split，是因为writefile写入的 NL 是无法用字符模拟的。这样当然会造成性能问题，如果有知道更好解决方案的，请留言告诉我。
</p>

</body>
</html>
